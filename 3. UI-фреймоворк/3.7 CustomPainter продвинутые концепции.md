## –û–±—Ä–µ–∑–∫–∞ —Ö–æ–ª—Å—Ç–∞

–£ –æ–±—ä–µ–∫—Ç–∞ `Canvas` –µ—Å—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è –æ–±—Ä–µ–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: `clipRect`,  `clipPath`, `clipRRect`. 

–ù–∞–ø—Ä–∏–º–µ—Ä, —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∑–æ–Ω—É –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞. –î–æ–ø—É—Å—Ç–∏–º, –Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–∫—Ä–∞—Å–∏—Ç—å —Ñ–æ–Ω —Ö–æ–ª—Å—Ç–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç. –î–ª—è —ç—Ç–æ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –º–µ—Ç–æ–¥–æ–º `drawColor` ‚Äî –∏ –≤–æ—Ç –∫–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–∏—Ç—Å—è:

```dart
@override
void paint(Canvas canvas, Size size) {
	canvas.drawColor(Colors.red, BlendMode.src);
}
```

`CustomPaint` —Ä–∞—Å—Ç—è–Ω—É—Ç –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –∏ –æ–±—ë—Ä–Ω—É—Ç –≤ `SafeArea`, –Ω–æ –º–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å —á—Ç–æ system bar (–ø–∞–Ω–µ–ª—å –≤ –≤–µ—Ä—Ö—É —ç–∫—Ä–∞–Ω–∞) —Ç–æ–∂–µ –æ–∫—Ä–∞—Å–∏–ª—Å—è –≤ –∫—Ä–∞—Å–Ω—ã–π. –û–±—Ä–µ–∂–µ–º –∑–æ–Ω—É –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ø–æ —Ä–∞–∑–º–µ—Ä—É —Ö–æ–ª—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `clipRect`.

```dart
@override
void paint(Canvas canvas, Size size) {
	// –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –ª–µ–≤–æ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É–≥–ª–∞ —Ö–æ–ª—Å—Ç–∞
  const leftTopCorner = Offset(0, 0);
  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –ø—Ä–∞–≤–æ–≥–æ –Ω–∏–∂–Ω–µ–≥–æ —É–≥–ª–∞ —Ö–æ–ª—Å—Ç–∞
  final rightBottomCorner = Offset(size.width, size.height);

  // –ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç —Ö–æ–ª—Å—Ç–∞ –±—É–¥–µ—Ç –æ–±—Ä–µ–∑–∞–Ω
  final rect = Rect.fromPoints(leftTopCorner, rightBottomCorner);

  canvas.clipRect(rect);
  canvas.drawColor(Colors.red, BlendMode.src);
}
```

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, –∑–æ–Ω–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –æ–±—Ä–µ–∑–∞–ª–∞—Å—å –ø–æ —Ä–∞–∑–º–µ—Ä—É —Ö–æ–ª—Å—Ç–∞.

![Group_22_e196e804ba.svg](https://yastatic.net/s3/education-portal/media/Group_22_e196e804ba_8a804fcc73.svg)

![Group_12_8a9306c09f.svg](https://yastatic.net/s3/education-portal/media/Group_12_8a9306c09f_b88b5d49e9.svg)

–î–∞–≤–∞–π—Ç–µ —Å–µ–π—á–∞—Å —á—É—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∏–º—Å—è –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ¬´–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º¬ª:

1. –°–Ω–∞—á–∞–ª–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `canvas.clipRect` ‚Äî —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–∞—è —Å–ª–µ–¥—É—é—â–∞—è –ø–æ—Å–ª–µ –Ω–µ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –±—É–¥–µ—Ç –æ–±—Ä–µ–∑–∞—Ç—å—Å—è –ø–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—é.
2. –ó–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ `canvas.drawColor`, –∫–æ—Ç–æ—Ä–∞—è –æ–∫—Ä–∞—à–∏–≤–∞–µ—Ç –≤–µ—Å—å —Ö–æ–ª—Å—Ç –≤ –æ–¥–∏–Ω —Ü–≤–µ—Ç. 

–¢–∞–∫–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–µ–ª—å–∑—è –Ω–∞–∑–≤–∞—Ç—å —Ö–æ—Ä–æ—à–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º ‚Äî –æ–Ω –æ–±—Ä–µ–∑–∞–µ—Ç –∫–∞–∂–¥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω–æ. –í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ —ç—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º–æ, –Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ –æ–±—Ä–µ–∑–∞—Ç—å –Ω–µ –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é, –∞ –ø—è—Ç—å-—à–µ—Å—Ç—å, –∏ –≤—Å—ë —ç—Ç–æ –≤ —Ü–∏–∫–ª–µ.

–í–æ—Ç –µ—â—ë –ø—Ä–∏–º–µ—Ä. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é `clipRRect`, –¥–ª—è –æ–±—Ä–µ–∑–∫–∏ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ–º—ã—Ö —Ü–≤–µ—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Å –∑–∞–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–º–∏ —É–≥–ª–∞–º–∏.

```dart
  @override
  void paint(Canvas canvas, Size size) {
    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –ª–µ–≤–æ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É–≥–ª–∞ —Ö–æ–ª—Å—Ç–∞
    const leftTopCorner = Offset(0, 0);
    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –ø—Ä–∞–≤–æ–≥–æ –Ω–∏–∂–Ω–µ–≥–æ —É–≥–ª–∞ —Ö–æ–ª—Å—Ç–∞
    final rightBottomCorner = Offset(size.width, size.height);

    // –ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç —Ö–æ–ª—Å—Ç–∞ –±—É–¥–µ—Ç –æ–±—Ä–µ–∑–∞–Ω
    final rect = Rect.fromPoints(leftTopCorner, rightBottomCorner);
    final rrect = RRect.fromRectAndRadius(rect, const Radius.circular(150));

    // –û–±—Ä–µ–∑–∞–µ—Ç —Ö–æ—Å—Ç –≤ —Ñ–æ—Ä–º–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Å –∑–∞–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–º–∏ —É–≥–ª–∞–º–∏
    canvas.clipRRect(rrect);

    // –ù–∞ —Ö–æ–ª—Å—Ç–µ —Ä–∏—Å—É–µ—Ç—Å—è —Å–∏–Ω–∏–π, –∑–∞—Ç–µ–º –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏–µ–π [clipRRect]
    canvas.drawColor(Colors.blue, BlendMode.srcATop);
    // –ù–∞ —Ö–æ–ª—Å—Ç–µ —Ä–∏—Å—É–µ—Ç—Å—è –∑–µ–ª—ë–Ω—ã–π, –∑–∞—Ç–µ–º –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏–µ–π [clipRRect]
    canvas.drawColor(Colors.green, BlendMode.srcATop);
    // –ù–∞ —Ö–æ–ª—Å—Ç–µ —Ä–∏—Å—É–µ—Ç—Å—è –∫—Ä–∞—Å–Ω—ã–π, –∑–∞—Ç–µ–º –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏–µ–π [clipRRect]
    canvas.drawColor(Colors.red, BlendMode.srcATop);
  }
```

–ß—Ç–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç—Ä–∏—Å–æ–≤–∫–∏, –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —Å–ª–æ—è–º–∏. 

## –°–ª–æ–∏

–ï—Å–ª–∏ –≤—ã —Ä–∞–±–æ—Ç–∞–ª–∏ –≤ —Ñ–æ—Ç–æ—Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –Ω–∞–ø–æ–¥–æ–±–∏–µ Photoshop, —Ç–æ –∏–º–µ–µ—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ —Å–ª–æ—è—Ö. –ï—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –≤–æ—Ç –ø—Ä–æ—Å—Ç–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ:

> –°–ª–æ–π ‚Äî —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–≤–µ—Ä—Ö —Ö–æ–ª—Å—Ç–∞. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, —Å–ª–æ–∏ –º–æ–∂–Ω–æ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—Ç—å –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞ –∏–ª–∏ —Å–º–µ—à–∏–≤–∞—Ç—å –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º.
> 

–í–æ—Ç –∫–∞–∫ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–µ–∑–∫—É —Ö–æ–ª—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é —Å–ª–æ—ë–≤ ‚Äî¬†–æ—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –º—ã –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±—Ä–µ–∑–∞–Ω–∏—è –∏ —Å–Ω–∞—á–∞–ª–∞ –º–µ—Ä–∂–∏–º –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Å–æ–±–æ–π –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–ª–æ–µ:

```dart
@override
void paint(Canvas canvas, Size size) {
  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –ª–µ–≤–æ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É–≥–ª–∞ —Ö–æ–ª—Å—Ç–∞
  const leftTopCorner = Offset(0, 0);
  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –ø—Ä–∞–≤–æ–≥–æ –Ω–∏–∂–Ω–µ–≥–æ —É–≥–ª–∞ —Ö–æ–ª—Å—Ç–∞
  final rightBottomCorner = Offset(size.width, size.height);

  // –ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç —Ö–æ–ª—Å—Ç–∞ –±—É–¥–µ—Ç –æ–±—Ä–µ–∑–∞–Ω
  final rect = Rect.fromPoints(leftTopCorner, rightBottomCorner);
  final rrect = RRect.fromRectAndRadius(rect, const Radius.circular(150));
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–æ–ª—Å—Ç–∞ –¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–µ–∑–∞–Ω–∏—è
  canvas.save();
  canvas.clipRRect(rrect);
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é –æ–±—Ä–µ–∑–∫–∏
  canvas.saveLayer(null, Paint());
  // * –ó–¥–µ—Å—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É —Å–æ–±–æ–π

  canvas.drawColor(Colors.blue, BlendMode.srcATop);
  canvas.drawColor(Colors.green, BlendMode.srcATop);
  canvas.drawColor(Colors.red, BlendMode.srcATop);

  // –ü—Ä–∏–º–µ–Ω—è–µ—Ç –æ–±—Ä–µ–∑–∞–Ω–∏–µ
  canvas.restore();
  // * –ó–¥–µ—Å—å –∫–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –æ–±—Ä–µ–∑–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
  // –í–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö–æ–ª—Å—Ç–∞ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—è —Å–ª–æ–π —Å –æ–±—Ä–µ–∑–∞–Ω–∏–µ–º —Å–≤–µ—Ä—Ö—É
  canvas.restore();
  // * –ó–¥–µ—Å—å –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –æ–±—Ä–µ–∑–∞–Ω–∏–µ
}
```

–í –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω–æ–º –∫–æ–¥–µ –≤–∏–¥–Ω–æ, —á—Ç–æ –ø–æ–º–∏–º–æ –≤—ã–∑–æ–≤–∞ `clipRRect` –µ—Å—Ç—å –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤ `save`, `saveLayer`–∏ `restore`.  –†–∞–∑–±–µ—Ä—ë–º—Å—è —Å –∫–∞–∂–¥—ã–º –∏–∑ –Ω–∏—Ö –ø–æ–¥—Ä–æ–±–Ω–µ–µ.

### save

–ú–µ—Ç–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö–æ–ª—Å—Ç–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞. –ß—Ç–æ–±—ã –ø—Ä–æ—â–µ –æ—Å–æ–∑–Ω–∞—Ç—å —ç—Ç–æ, –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å, —á—Ç–æ –≤—ã–∑–æ–≤ `save` —Å–æ–∑–¥–∞—ë—Ç —Å–∫–æ—É–ø, –≤ –∫–æ—Ç–æ—Ä–æ–º –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ö–æ–ª—Å—Ç–∞ ‚Äî –æ–±—Ä–µ–∑–∞–Ω–∏–µ, —Ä–∞–∑–≤–æ—Ä–æ—Ç –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ `restore` —Å–∫–æ—É–ø –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –∏ –¥–∞–ª–µ–µ –≤—Å–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫ –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –æ–ø–µ—Ä–∞—Ü–∏—è–º.

### saveLayer

–ú–µ—Ç–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö–æ–ª—Å—Ç–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤—ã–∑–æ–≤—É `save` –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å, —á—Ç–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–∫–æ—É–ø. –û—Å–Ω–æ–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ –≤ —Ç–æ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–π —Å–∫–æ—É–ø ‚Äî —ç—Ç–æ –Ω–æ–≤—ã–π —á–∏—Å—Ç—ã–π —Å–ª–æ–π, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –Ω–µ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è —Ä–∞–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Ö–æ–ª—Å—Ç–∞.

### restore

–í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ `restore` –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–æ–≤—ã–π —Å–ª–æ–π –∏–∑ —Å–∫–æ—É–ø–∞ —Å —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ö–æ–ª—Å—Ç–∞ ‚Äî –∞ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Ç–∞–∫–∂–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ —Ä–∞–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫ –Ω–æ–≤–æ–º—É —Å–ª–æ—é.

–° –º–µ—Ç–æ–¥–∞–º–∏ —Ä–∞–∑–æ–±—Ä–∞–ª–∏—Å—å. –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –Ω–∞–º –∏–∑–≤–µ—Å—Ç–Ω–æ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å–ª–æ—è–º–∏, –¥–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –µ—â—ë –æ–¥–∏–Ω –º–µ—Ö–∞–Ω–∏–∑–º –∫–æ—Ç–æ—Ä—ã–π –Ω–∞ –Ω–∏—Ö –æ—Å–Ω–æ–≤–∞–Ω ‚Äî —ç—Ç–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —Ö–æ–ª—Å—Ç–∞.

## –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è

–ò–Ω–æ–≥–¥–∞ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∏–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å—Ç—å —Ö–æ–ª—Å—Ç —Å —É–∂–µ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–≤–µ—Ä–Ω—É—Ç—å –≥–æ—Ç–æ–≤—É—é —Ñ–∏–≥—É—Ä—É –∏–ª–∏ –Ω–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–∏—Ç—å –µ—ë. –£ `Canvas` –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã  –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Ö–æ–ª—Å—Ç–∞:

- `translate` ‚Äî —Å–¥–≤–∏–≥–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—É—é —Å–µ—Ç–∫—É –Ω–∞ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –æ—Å—è–º X –∏ Y.
- `rotate` ‚Äî –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Ö–æ–ª—Å—Ç –Ω–∞ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π —É–≥–æ–ª –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö.
- `scale` ‚Äî —É–º–Ω–æ–∂–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ö–æ–ª—Å—Ç–∞ –Ω–∞ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
    
    –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —Ä–∞–∑–º–µ—Ä–æ–º 100—Ö200, –≤–µ—Ä—Ö–Ω–∏–π –ª–µ–≤—ã–π —É–≥–æ–ª –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö (100; 150), –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ scale(2) –ø—Ä–∏–º–µ—Ç —Ä–∞–∑–º–µ—Ä—ã 200—Ö400 –∏ –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö (200; 300).
    
- `skew` ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ö–æ–ª—Å—Ç, –Ω–∞–∫–ª–æ–Ω—è—è –µ–≥–æ –≤ 2D-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ.
- `transform` ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∞—Ç—Ä–∏—Ü—É —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫ —Ö–æ–ª—Å—Ç—É.

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –Ω–∞ –Ω–∏—Ö –Ω–µ –±—É–¥–µ–º ‚Äî –≤ –∫–æ–Ω—Ü–µ —ç—Ç–æ–π –≥–ª–∞–≤–∫–∏ –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º—ã —Å—Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –Ω—é–∞–Ω—Å–∞—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏.

### –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ

–°–¥–µ–ª–∞–≤ –∫–∞–∫—É—é-–ª–∏–±–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é, –≤—ã –≤–µ—Ä–æ—è—Ç–Ω–æ —Å—Ç–æ–ª–∫–Ω—ë—Ç–µ—Å—å —Å —Å–∏—Ç—É–∞—Ü–∏–µ–π, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –≤—ã –æ–∂–∏–¥–∞–ª–∏: —Ñ–∏–≥—É—Ä–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ö–æ—Ç–µ–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å, –º–æ–∂–µ—Ç –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è —Å–æ–≤—Å–µ–º –≤ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ –∏–ª–∏ –≤–æ–≤—Å–µ –∏—Å—á–µ–∑–Ω—É—Ç—å —Å —ç–∫—Ä–∞–Ω–∞. 

–ü–æ—á–µ–º—É —Ç–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—Ç–ª–∏—á–Ω–æ –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∏–∂–µ:  –≤—Å–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ª–µ–≤–æ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ –∫—Ä–∞—è —Ö–æ–ª—Å—Ç–∞.

![flt_2_7_ef8ac15c7e.svg](https://yastatic.net/s3/education-portal/media/flt_2_7_ef8ac15c7e_da533d3c57.svg)

–ß—Ç–æ–±—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞. –î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `translate` —Å–º–µ—Å—Ç–∏—Ç—å —Ö–æ–ª—Å—Ç –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ –æ–±—ä–µ–∫—Ç–∞ –∏ –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤–µ—Ä–Ω—É—Ç—å —Ö–æ–ª—Å—Ç –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ, –≤—ã–∑–≤–∞–≤ –º–µ—Ç–æ–¥ `translate` —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏.

```dart
// –°–¥–≤–∏–≥–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—É—é –ø–ª–æ—Å–∫–æ—Å—Ç—å –∫ —Ü–µ–Ω—Ç—Ä—É
canvas.translate(center.dx, center.dy);
// –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —Ö–æ–ª—Å—Ç
canvas.rotate(math.pi / 2);
// –°–¥–≤–∏–≥–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω—É—é –ø–ª–æ—Å–∫–æ—Å—Ç—å –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
canvas.translate(-center.dx, -center.dy);
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ª–æ—ë–≤

–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Ö–æ–ª—Å—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–≤–µ—Ä—à–∞—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–ª–æ–µ. –¢–∞–∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ 

```dart
// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ª–æ–π
canvas.save();

// –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —Ö–æ–ª—Å—Ç–∞
canvas.translate(center.dx, center.dy);
canvas.rotate(math.pi / 2);
canvas.translate(-center.dx, -center.dy);

final trianglePath = Path()
      ..moveTo(center.dx, center.dy - radius)
      ..lineTo(center.dx + radius, center.dy)
      ..lineTo(center.dx - radius, center.dy)
      ..close();

// –†–∏—Å—É–µ–º —Å–∏–Ω–∏–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫
canvas.drawPath(
	trianglePath,
	painter..color = Colors.blue.withOpacity(0.5),
);

// –í–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª–æ–π
canvas.restore();

// –†–∏—Å—É–µ–º –∫—Ä–∞—Å–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫
canvas.drawPath(
	trianglePath,
	painter..color = Colors.red.withOpacity(0.5),
);

```

![Group_13_60439c9b53.svg](https://yastatic.net/s3/education-portal/media/Group_13_60439c9b53_c8e348506f.svg)

–ö–∞–∫ –º–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, –º—ã —Ä–∏—Å—É–µ–º –æ–±–∞ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞ –≤ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö, –Ω–æ –≤ —Å–ª—É—á–∞–µ —Å–∏–Ω–µ–≥–æ –º—ã –∏–∑–º–µ–Ω—è–µ–º —Å–∞–º—É —Å–∏—Å—Ç–µ–º—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.

### –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

–î–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏–≤–µ–¥—ë–º —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–º–µ—Ä ‚Äî –∫–æ–º–ø–∞—Å, –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω–Ω—ã–π —Å –ø–æ–º–æ—â—å—é `CustomPainter`.  –£ –Ω–∞—Å –µ—Å—Ç—å –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: —Å—Ç–∞—Ç–∏—á–Ω–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ –∏ –∏–∑–º–µ–Ω—è—é—â–∞—è —Å–≤–æ—ë –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ–ª–∫–∞.

/iframe/(src="https://education-dartpad-prod.s3-website.yandex.net/?path=3.7_custom_painter_advanced/1/main.dart" height="500")

–ï—â—ë –æ–¥–∏–Ω –∞—Å–ø–µ–∫—Ç –Ω–∞–ø—Ä—è–º—É—é —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å–æ —Å–ª–æ—è–º–∏ ‚Äî BlendMode. –≠—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ —Ä–∞–∑–Ω—ã–µ —Å–ª–æ–∏ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞, –∏ –∫–∞–∫–∏–µ —Ü–≤–µ—Ç–∞ –ø–æ–ª—É—á–∞—é—Ç—Å—è –≤ –∏—Ç–æ–≥–µ.

## BlendMode

–°—Ç—Ä–æ–≥–æ –≥–æ–≤–æ—Ä—è, BlendMode ‚Äî —ç—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º—ã, –¥–ª—è —Å–º–µ—à–∏–≤–∞–Ω–∏—è –ø–∏–∫—Å–µ–ª–µ–π. –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –∫–ª–∞—Å—Å–∞ `BlendMode`. –≠—Ç–æ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —á—É—Ç—å –ø–æ–∑–∂–µ, –ø–æ–∫–∞ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —Ç–æ–º, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç —Ü–≤–µ—Ç–∞.

–ö–∞–∂–¥—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –∏–º–µ–µ—Ç –¥–≤–∞ –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞: 

- source ‚Äî —Ä–∏—Å—É–µ–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ;
- destination ‚Äî –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –∫–æ–º–ø–æ–Ω—É–µ—Ç—Å—è source.

`destination` —á–∞—Å—Ç–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Ñ–æ–Ω. –ö–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫, —Ç–∞–∫ –∏ –ø—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ—é—Ç —á–µ—Ç—ã—Ä–µ —Ü–≤–µ—Ç–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–∞: –∫—Ä–∞—Å–Ω—ã–π, –∑–µ–ª–µ–Ω—ã–π, —Å–∏–Ω–∏–π –∏ –∞–ª—å—Ñ–∞-–∫–∞–Ω–∞–ª—ã. 

–û–±—ã—á–Ω–æ –æ–Ω–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ –≤–∏–¥–µ —á–∏—Å–µ–ª –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 0,0 –¥–æ 1,0. –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ç–∞–∫–∂–µ –∏–º–µ—é—Ç —Ç–µ –∂–µ —á–µ—Ç—ã—Ä–µ –∫–∞–Ω–∞–ª–∞ —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–º–∏ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏ –ø—É–Ω–∫—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.

–¶–µ–ª—å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ `BlendMode` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –Ω–∞ –≤—Ö–æ–¥ 4 –∫–∞–Ω–∞–ª–∞ `destination` –∏ 4 –∫–∞–Ω–∞–ª–∞ `source` –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –∏—Ö –≤ 4 –∫–∞–Ω–∞–ª–∞ –ø–∏–∫—Å–µ–ª—è.

–î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–º –∑–∞–¥–∞—á—É —Å–º–µ—à–µ–Ω–∏—è –ø–∏–∫—Å–µ–ª–µ–π –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º –º–µ—Ç–æ–¥–æ–º:

```dart
Color? resolveColor(Color? source, Color? destination);
```

–¢–æ–≥–¥–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é `BlendMode.srcOver`, ‚Äî –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ `Paint`, –æ–±—ã—á–Ω–æ–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞ —Ñ–æ–Ω, ‚Äî –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Ç–∞–∫:

```dart
Color? resolveColor(Color? source, Color? destination) {
	return destination ?? source;
}
```

–¢–æ –µ—Å—Ç—å –µ—Å–ª–∏ –ø–∏–∫—Å–µ–ª—å –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ–º–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –ø—É—Å—Ç–æ–π ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ, –∏–Ω–∞—á–µ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∏–∫—Å–µ–ª—å —Ñ–æ–Ω–∞.

–í—Å–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ `BlendMode` –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://api.flutter.dev/flutter/dart-ui/BlendMode.html), –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–π–¥—ë–º –∫ –ø—Ä–∏–º–µ—Ä—É.

### BlendMode –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `BlendMode`. –¢—É—Ç –Ω–∞–º —Å–Ω–æ–≤–∞ –ø–æ–º–æ–≥—É—Ç —Å–ª–æ–∏:

```dart
class BlendModePainter extends CustomPainter {
  const BlendModePainter();

  @override
  void paint(Canvas canvas, Size size) {
    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y —Å–µ—Ä–µ–¥–∏–Ω—ã —Ö–æ–ª—Å—Ç–∞
    final verticalCenter = size.height / 2;
    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X —Å–µ—Ä–µ–¥–∏–Ω—ã —Ö–æ–ª—Å—Ç–∞
    final horizontalCenter = size.width / 2;
    // –°–µ—Ä–µ–¥–∏–Ω–∞ —Ö–æ–ª—Å—Ç–∞
    final center = Offset(horizontalCenter, verticalCenter);
    // –†–∞–¥–∏—É—Å –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏
    final radius = size.shortestSide / 6;
    // –°—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞–ª–æ–∂–µ–Ω–∏—è —Å–ª–æ—ë–≤
    const blendMode = BlendMode.plus;

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–æ–Ω / –í—ã–¥–µ–ª—è–µ–º –æ—Ç—Ä–∏—Å–æ–≤–∫—É –∫—Ä—É–≥–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π
    canvas.saveLayer(null, Paint());

    // –†–∏—Å—É–µ–º –∫—Ä–∞—Å–Ω—ã–π –∫—Ä—É–≥
    canvas.drawCircle(
      center.translate(0, -radius),
      radius,
      // –¢.–∫. —Å–ª–æ–π –Ω–æ–≤—ã–π, –ø–µ—Ä–≤—ã–π –∫—Ä—É–≥ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–∏—Å–æ–≤–∞—Ç—å
      // c BlendMode.exclusion
      Paint()..color = const Color(0xFFFF0000),
    );

    // –†–∏—Å—É–µ–º –∑–µ–ª—ë–Ω—ã–π –∫—Ä—É–≥
    canvas.drawCircle(
      center.translate(-radius / 2, 0),
      radius,
      Paint()
        ..color = const Color(0xFF00FF00)
        ..blendMode = blendMode,
    );

		// –í—ã–¥–µ–ª—è–µ–º —Å–ª–æ–π –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å–∏–Ω–µ–≥–æ –∫—Ä—É–≥–∞
    canvas.saveLayer(null, Paint()..blendMode = blendMode);
    // –†–∏—Å—É–µ–º —Å–∏–Ω–∏–π –∫—Ä—É–≥
    canvas.drawCircle(
      center.translate(radius / 2, 0),
      radius,
      Paint()..color = const Color(0xFF0000FF),
    );
    // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å–ª–æ–π —Å–∏–Ω–µ–≥–æ –∫—Ä—É–≥–∞ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏
    canvas.restore();

    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –∫—Ä—É–≥–∏ —Å –∏—Å—Ö–æ–¥–Ω—ã–º —Ñ–æ–Ω–æ–º
    canvas.restore();
  }

  @override
  bool shouldRepaint(covariant CustomPainter oldDelegate) => false;
}
```

![Group_14_bf7da5cd45.svg](https://yastatic.net/s3/education-portal/media/Group_14_bf7da5cd45_8245fc70a2.svg)

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–º–µ—à–∏–≤–∞–Ω–∏—è `BlendMode.plus`. –ö–∞–∫ –º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è ‚Äî —ç—Ç–æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º —Å—É–º–º–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–∏ –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞ –∫—Ä—É–≥–æ–≤ –æ–Ω–∏ –æ–±—Ä–∞–∑—É—é—Ç —Ç–∞–∫—É—é –∫–∞—Ä—Ç–∏–Ω—É.

–¢–∞–∫–∂–µ –º—ã —Ö–æ—Ç–µ–ª–∏ –±—ã –∞–∫—Ü–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ —á–∏—Ç–∞—Ç–µ–ª—è –Ω–∞ —Ç–æ, –∫–∞–∫ —Ä–∏—Å—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –∏–∑ –∫—Ä—É–≥–æ–≤ –≤ –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ. 

- –ö—Ä–∞—Å–Ω—ã–π –∫—Ä—É–≥ —Ä–∏—Å—É–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è `BlendMode` , —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–º —Å–ª–æ–µ, –∏ –µ–º—É –ø—Ä–æ—Å—Ç–æ –Ω–µ —Å —á–µ–º —Å–º–µ—à–∏–≤–∞—Ç—å—Å—è.
- –ó–µ–ª—ë–Ω—ã–π –∫—Ä—É–≥ —Ä–∏—Å—É–µ—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–∞ `Paint`, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `blendMode` —Ä–∞–≤–µ–Ω `BlendMode.plus`.
- –°–∏–Ω–∏–π –∫—Ä—É–≥, —Ä–∏—Å—É–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–ª–æ–µ. –ó–¥–µ—Å—å —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–µ—Ç–æ–¥–∞ `saveLayer` –æ–±—ä–µ–∫—Ç—É `Paint`  —Ç–∞–∫–∂–µ –∑–∞–¥–∞—ë—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ `BlendMode.plus`. –¢–æ –µ—Å—Ç—å –ø–æ–º–∏–º–æ —Å–∏–Ω–µ–≥–æ –∫—Ä—É–≥–∞ –≤ —ç—Ç–æ–º —Å–ª–æ–µ –º–æ–∂–Ω–æ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å –µ—â—ë, –∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–µ—Ç–æ–¥–∞ restore –≤–µ—Å—å —Å–ª–æ–π –±—É–¥–µ—Ç –æ–±—ä–µ–¥–∏–Ω—è—Ç—å—Å—è —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ `BlendMode.plus`.

C BlendMode –∑–∞–∫–æ–Ω—á–∏–ª–∏. –î–∞–ª–µ–µ –≤ —ç—Ç–æ–º –ø–∞—Ä–∞–≥—Ä–∞—Ñ–µ –Ω–∞–º –æ—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —à–µ–π–¥–µ—Ä—ã ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ—Ç –≤–æ Flutter. 

## Shaders

–®–µ–π–¥–µ—Ä—ã ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–æ–±–æ–º —è–∑—ã–∫–µ (GLSL –∏–ª–∏ HLSL). 

–û–Ω–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –∞–ª–≥–æ—Ä–∏—Ç–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∞–¥–∏–π 3D-–≥—Ä–∞—Ñ–∏–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞–º–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

–ö–ª–∞—Å—Å `Paint` —Ç–∞–∫ –∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∏—Å–æ–≤–∞—Ç—å —à–µ–π–¥–µ—Ä—ã. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä `shader` –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞ –∫–ª–∞—Å—Å `Shader`.

### –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —à–µ–π–¥–µ—Ä—ã

–í–æ Flutter —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–µ–∫–æ—Ç–æ—Ä—ã–π –Ω–∞–±–æ—Ä —à–µ–π–¥–µ—Ä–æ–≤: `LinearGradient`, `RadialGradient`, `SweepGradient`, `ImageShader`.

–°—Ç–æ–∏—Ç —É—Ç–æ—á–Ω–∏—Ç—å, —á—Ç–æ –∫–ª–∞—Å—Å—ã  `LinearGradient`, `RadialGradient`, `SweepGradient` –Ω–∞—Å–ª–µ–¥—É–µ–º—ã–µ –æ—Ç `Gradient` (*package:flutter/src/painting/gradient.dart*) ‚Äî —ç—Ç–æ –Ω–µ —à–µ–π–¥–µ—Ä—ã. –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —à–µ–π–¥–µ—Ä, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ `createShader`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç `Gradient` –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ *dart:ui* ‚Äî –∏ –≤–æ—Ç —É–∂–µ –æ–Ω **—è–≤–ª—è–µ—Ç—Å—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–º –∫–ª–∞—Å—Å–∞ `Shader`.

–í–æ—Ç –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–∏–º–µ—Ä  ‚Äî —Ç–µ–∫—Å—Ç, —Ä–∞—Å–∫—Ä–∞—à–µ–Ω–Ω—ã–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —à–µ–π–¥–µ—Ä–∞ –ª–∏–Ω–µ–π–Ω–æ–≥–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞.

```dart
 GradientShaderPainter extends CustomPainter {
  const GradientShaderPainter();

  @override
  void paint(Canvas canvas, Size size) {
    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y —Å–µ—Ä–µ–¥–∏–Ω—ã —Ö–æ–ª—Å—Ç–∞
    final verticalCenter = size.height / 2;
    // –°–º–µ—â–µ–Ω–∏–µ
    final offset = Offset(0, verticalCenter);

    // –®–µ–π–¥–µ—Ä –ª–∏–Ω–µ–π–Ω–æ–≥–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞
    final shader = const LinearGradient(
      colors: [Colors.red, Colors.blue],
    ).createShader(Rect.fromLTWH(0, 0, size.width, size.height));
		
		// –í—ã–¥–µ–ª—è–µ–º —Å–ª–æ–π –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞
    canvas.saveLayer(null, Paint());

    TextPainter(
      text: const TextSpan(
        text: '–¢–µ–∫—Å—Ç –Ω–∞–ø–∏—Å–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —à–µ–π–¥–µ—Ä–æ–≤',
        style: TextStyle(color: Colors.black),
      ),
      textDirection: TextDirection.ltr,
      textAlign: TextAlign.center,
    )
      // –†–∞—Å—á—ë—Ç —Ä–∞–∑–º–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç
      ..layout(minWidth: size.width, maxWidth: size.width)
      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Ö–æ–ª—Å—Ç–µ
      ..paint(canvas, offset);

		// –í—ã–¥–µ–ª—è–µ–º —Å–ª–æ–π –¥–ª—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞
    canvas.saveLayer(null, Paint()..blendMode = BlendMode.srcATop);
		// –†–∏—Å—É–µ–º –Ω–∞ —Ö–æ–ª—Å—Ç–µ Paint —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
    canvas.drawPaint(Paint()..shader = shader);
		// –û–±—ä–µ–¥–∏–Ω—è–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
    canvas.restore();
		
		// –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ç–µ–∫—Å—Ç —Å –∏—Å—Ö–æ–¥–Ω—ã–º —Ñ–æ–Ω–æ–º
    canvas.restore();
  }

  @override
  bool shouldRepaint(covariant CustomPainter oldDelegate) => false;
}
```

![Group_15_749152914a.svg](https://yastatic.net/s3/education-portal/media/Group_15_749152914a_09ffc70505.svg)

`BlendMode.srcATop` ‚Äî –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (source) —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å —Ñ–æ–Ω–æ–º (destination). –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ source ‚Äî —ç—Ç–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç, –∞ destination ‚Äî —Ç–µ–∫—Å—Ç.

### –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —à–µ–π–¥–µ—Ä—ã

–í–æ Flutter –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —à–µ–π–¥–µ—Ä—ã, –¥–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –ü–æ–º–µ—Å—Ç–∏—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç —Ñ–∞–π–ª —à–µ–π–¥–µ—Ä–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ *glsl* (–Ω–∞–ø–æ–º–Ω–∏–º, GLSL ‚Äî [—è–∑—ã–∫](https://ru.wikipedia.org/wiki/OpenGL_Shading_Language) –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —à–µ–π–¥–µ—Ä–æ–≤). –§–∞–π–ª –∏–º–µ–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ *.frag*.
2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∞—Å—Å–µ—Ç–∞–º–∏ –≤ *pubspec.yaml* —Å–µ–∫—Ü–∏—é *shaders* –∏ —É–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞ —à–µ–π–¥–µ—Ä–∞.
3. –°–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç `FragmentProgram` —á–µ—Ä–µ–∑ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `fromAsset`, –ø–µ—Ä–µ–¥–∞–≤ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —à–µ–π–¥–µ—Ä–∞.
4. –í—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥ `fragmentShader`, —É —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ `FragmentProgram`.

–î–∞–≤–∞–π—Ç–µ –∂–µ –ø—Ä–∏—Å—Ç—É–ø–∏–º. –î–ª—è –Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª *custom_shader.frag* –∏ –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤  *pubspec.yaml* –≤ —Å–µ–∫—Ü–∏—é *shaders*. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –ø–æ–∫–∞–∂–µ–º —á—É—Ç—å –Ω–∏–∂–µ.

```yaml
flutter:
  shaders:
    - assets/shaders/custom_shader.frag
```

–ó–∞–≥—Ä—É–∑–∫–∞ —à–µ–π–¥–µ—Ä–∞ ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –ø–æ—ç—Ç–æ–º—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —à–µ–π–¥–µ—Ä –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –µ–≥–æ –≤ `CustomPainter`.

```dart
Future<FragmentShader> _loadShader(String shaderAssetPath) async {
  final program = await FragmentProgram.fromAsset(shaderAssetPath);

  return program.fragmentShader();
}
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å `CustomPainter` –∏ –ø–µ—Ä–µ–¥–∞—Ç—å —Ç—É–¥–∞ —à–µ–π–¥–µ—Ä.

```dart
class ShaderPainter extends CustomPainter {
  final FragmentShader shader;

  ShaderPainter({required this.shader});

  @override
  void paint(Canvas canvas, Size size) {
    final paint = Paint()..shader = shader;
    canvas.drawRect(
      Rect.fromLTWH(0, 0, size.width, size.height),
      paint,
    );
  }

  @override
  bool shouldRepaint(covariant CustomPainter oldDelegate) => false;
}
```

–ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ Flutter ‚Äî –≤—Å—ë –≥–æ—Ç–æ–≤–æ —á—Ç–æ–±—ã –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å —à–µ–π–¥–µ—Ä, –Ω–æ –ø–æ–∫–∞ –Ω–∞—à —Ñ–∞–π–ª —à–µ–π–¥–µ—Ä–∞ –ø—É—Å—Ç. –ò—Å–ø—Ä–∞–≤–∏–º —ç—Ç–æ! –î–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞—Ä–∏—Å—É–µ–º —Å–∏–Ω–∏–π —Ñ–æ–Ω.

```glsl
// –í–µ—Ä—Å–∏—è API
#version 460 core

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è Flutter
#include <flutter/runtime_effect.glsl>

// –¢–æ—á–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π GPU
precision mediump float;

// –ò—Ç–æ–≥–æ–≤—ã–π —Ü–≤–µ—Ç –ø–∏–∫—Å–µ–ª—è
out vec4 fragColor;

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ - —Å–∏–Ω–∏–π —Ü–≤–µ—Ç
const vec3 blue = vec3(0, 0, 255) / 255;

void main() {
  fragColor = vec4(blue, 1);
}
```

![Group_16_19d943faf7.svg](https://yastatic.net/s3/education-portal/media/Group_16_19d943faf7_6736b1f1f1.svg)

–ú–µ—Ç–æ–¥ `main` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∏–∫—Å–µ–ª—è, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç –ø–∏–∫—Å–µ–ª—è (`fragColor`). –ü–µ—Ä–µ–¥–µ–ª–∞–µ–º –Ω–∞—à —à–µ–π–¥–µ—Ä —Ç–∞–∫ —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å —Ü–≤–µ—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≤—Ö–æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π. –î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—ä—è–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–æ–º `uniform` ‚Äî –æ–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–∞ —Å–Ω–∞—Ä—É–∂–∏.

```glsl
// –í–µ—Ä—Å–∏—è API
#version 460 core

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—É—Ä–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è Flutter
#include <flutter/runtime_effect.glsl>

// –¢–æ—á–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π GPU
precision mediump float;

// –ò—Ç–æ–≥–æ–≤—ã–π —Ü–≤–µ—Ç –ø–∏–∫—Å–µ–ª—è
out vec4 fragColor;

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –≤ —à–µ–π–¥–µ—Ä
uniform vec3 color; // –¶–≤–µ—Ç

void main() {
  fragColor = vec4(color/255, 1);
}
```

–ù–∞–ø–æ–º–Ω–∏–º, —á—Ç–æ –∫–∞–∂–¥—ã–π –∫–∞–Ω–∞–ª –ø–∏–∫—Å–µ–ª—è ‚Äî —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç 0 –¥–æ 254. –ù–æ –≤ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ GLSL –º—ã –æ–ø–µ—Ä–∏—Ä—É–µ–º –≤–µ–∫—Ç–æ—Ä–∞–º–∏, –∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–∞ —Ü–≤–µ—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ—Ç 0 –¥–æ 1. –ü–æ—ç—Ç–æ–º—É –¥–µ–ª–∏–º –≤–µ–∫—Ç–æ—Ä `color` –Ω–∞ 255.

–î–æ—Ä–∞–±–æ—Ç–∞–µ–º `CustomPainter` –∏ –ø–µ—Ä–µ–¥–∞–¥–∏–º —Ü–≤–µ—Ç –≤ —à–µ–π–¥–µ—Ä.

```dart
...
  static const color = Colors.red;

  @override
  void paint(Canvas canvas, Size size) {
    shader
      ..setFloat(0, color.red.toDouble())
      ..setFloat(1, color.green.toDouble())
      ..setFloat(2, color.blue.toDouble());

    final paint = Paint()..shader = shader;
    canvas.drawRect(
      Rect.fromLTWH(0, 0, size.width, size.height),
      paint,
    );
  }
...
```

![Group_17_da51a1dd2f.svg](https://yastatic.net/s3/education-portal/media/Group_17_da51a1dd2f_cf00cb2321.svg)

API —à–µ–π–¥–µ—Ä–∞ –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ. –ú—ã –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞—Ç—å –∫–∞–∂–¥—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç–¥–µ–ª—å–Ω–æ ‚Äî –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ `setFloat` –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∏ –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ.

–í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≤—Ö–æ–¥–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å —Ç–∏–ø–æ–º `vec3`. `vec3` ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑ —Ç—Ä—ë—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –ø–æ—ç—Ç–æ–º—É –º—ã –∏ –ø–µ—Ä–µ–¥–∞—ë–º –∑–Ω–∞—á–µ–Ω–∏—è, —É–∫–∞–∑—ã–≤–∞—è –∏–Ω–¥–µ–∫—Å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 0 –¥–æ 2. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º —á—Ç–æ –µ—Å—Ç—å –µ—â—ë –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å —Ç–∏–ø–æ–º `vec2` , —Ç–æ–≥–¥–∞ —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –Ω–µ—ë, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ `setFloat` –µ—â—ë –¥–≤–∞ —Ä–∞–∑–∞ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ 3 –∏ 4.

<aside>
üí° –í–∞–∂–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –∫–æ–¥–µ —à–µ–π–¥–µ—Ä–∞. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑.

</aside>

–°–µ–π—á–∞—Å –∫–∞–∂–¥—ã–π –ø–∏–∫—Å–µ–ª—å –∫—Ä–∞—Å–∏—Ç—å—Å—è –≤ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ü–≤–µ—Ç. –î–æ–±–∞–≤–∏–º –≤ —à–µ–π–¥–µ—Ä –ª–æ–≥–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å —è—Ä–∫–æ—Å—Ç—å —Ü–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Y-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–∏–∫—Å–µ–ª—è.

```glsl
// –í–µ—Ä—Å–∏—è API
#version 460 core

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—É—Ä–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è Flutter
#include <flutter/runtime_effect.glsl>

// –¢–æ—á–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π GPU
precision mediump float;

// –ò—Ç–æ–≥–æ–≤—ã–π —Ü–≤–µ—Ç –ø–∏–∫—Å–µ–ª—è
out vec4 fragColor;

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –≤ —à–µ–π–¥–µ—Ä
uniform vec3 color; // –¶–≤–µ—Ç
uniform vec2 resolution; // –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞

void main() {
  // –ö–æ–æ—Ä–¥–∏–∞–Ω—Ç—ã –ø–∏–∫—Å–µ–ª—è
  vec2 pixelCoord = FlutterFragCoord();

  // –ü–æ–∑–∏—Ü–∏—è –ø–∏–∫—Å–µ–ª—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞
  vec2 positionOnScreen = pixelCoord / resolution;
   
  fragColor = vec4((color/255) * positionOnScreen.y, 1);
}
```

–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞–¥–∏–º —Ä–∞–∑–º–µ—Ä—ã —ç–∫—Ä–∞–Ω–∞ –≤ `CustomPainter` –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º —á—Ç–æ –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ.

```dart
...
	@override
  void paint(Canvas canvas, Size size) {
    shader
      ..setFloat(0, color.red.toDouble())
      ..setFloat(1, color.green.toDouble())
      ..setFloat(2, color.blue.toDouble())
      ..setFloat(3, size.width)
      ..setFloat(4, size.height);

    final paint = Paint()..shader = shader;
    canvas.drawRect(
      Rect.fromLTWH(0, 0, size.width, size.height),
      paint,
    );
  }
...
```

![Group_18_d35eb1fa18.svg](https://yastatic.net/s3/education-portal/media/Group_18_d35eb1fa18_3ec524dec6.svg)

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –º—ã –ø–æ–ª—É—á–∏–ª–∏ —à–µ–π–¥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —è—Ä–∫–æ—Å—Ç—å —Ü–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Y-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, —Ç.–µ. –ø—Ä–æ—Å—Ç–µ–π—à–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç.

–ö–æ–Ω–µ—á–Ω–æ, –≤—Ä—è–¥ –ª–∏ –≤—ã –±—É–¥–µ—Ç–µ –ø–∏—Å–∞—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —à–µ–π–¥–µ—Ä—ã —Å–∞–º–∏. –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ —à–µ–π–¥–µ—Ä–∞ –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ä–µ—Å—É—Ä—Å–æ–º [GLSL SANDBOX](https://glslsandbox.com/) ‚Äî —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ WebGL –¥–ª—è live-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —à–µ–π–¥–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä–∞—è —Ç–∞–∫–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É —à–µ–π–¥–µ—Ä–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Ä–µ—Å—É—Ä—Å–∞.

–ù–æ –µ—Å—Ç—å –æ–¥–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞: —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –±–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —ç—Ç–∏ –≤–∏–¥–∂–µ—Ç—ã –Ω–µ –±—É–¥—É—Ç –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤–æ Flutter-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —à–µ–π–¥–µ—Ä–æ–≤ –≤–æ Flutter. 

–ü–æ—ç—Ç–æ–º—É –¥–∞–≤–∞–π—Ç–µ –≤–æ–∑—å–º—ë–º –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å —à–µ–π–¥–µ—Ä –∏ –ø–æ–ø—Ä–æ–±—É–µ–º –µ–≥–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä –≤–æ—Ç [—ç—Ç–æ—Ç](https://glslsandbox.com/e#7022.0). –°–∫–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –≤ —Ñ–∞–π–ª –∏ –¥–æ–±–∞–≤–∏–º –µ–≥–æ –≤ –ø—Ä–æ–µ–∫—Ç.

```glsl
#ifdef GL_ES
precision mediump float;
#endif

uniform float time;
uniform vec2 mouse;
uniform vec2 resolution;

const int MAXITER = 30;

vec3 field(vec3 p) {
	p *= .1;
	float f = .1;
	for (int i = 0; i < 3; i++) {
		p = p.yzx; //*mat3(.8,.6,0,-.6,.8,0,0,0,1);
//		p += vec3(.123,.456,.789)*float(i);
		p = abs(fract(p)-.5);
		p *= 2.0;
		f *= 2.0;
	}
	p *= p;
	return sqrt(p+p.yzx)/f-.05;
}

void main( void ) {
	vec3 dir = normalize(vec3((gl_FragCoord.xy-resolution*.5)/resolution.x,1.));
	float a = time * 0.1;
	vec3 pos = vec3(0.0,time*0.1,0.0);
	dir *= mat3(1,0,0,0,cos(a),-sin(a),0,sin(a),cos(a));
	dir *= mat3(cos(a),0,-sin(a),0,1,0,sin(a),0,cos(a));
	vec3 color = vec3(0);
	for (int i = 0; i < MAXITER; i++) {
		vec3 f2 = field(pos);
		float f = min(min(f2.x,f2.y),f2.z);
		
		pos += dir*f;
		color += float(MAXITER-i)/(f2+.01);
	}
	vec3 color3 = vec3(1.-1./(1.+color*(.09/float(MAXITER*MAXITER))));
	color3 *= color3;
	gl_FragColor = vec4(vec3(color3.r+color3.g+color3.b),1.);
}
```

–ü–æ–ø—ã—Ç–∞–≤—à–∏—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –º—ã –ø–æ–ª—É—á–∏–º –æ—à–∏–±–∫—É –µ—â—ë –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥, –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É—è—Å—å –Ω–∞ –ø—Ä–∏–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–¥–µ–ª–∞–ª–∏ —Ä–∞–Ω–µ–µ.

–í–æ-–ø–µ—Ä–≤—ã—Ö, –º–µ–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏:

```glsl
~~#ifdef GL_ES
precision mediump float;
#endif~~

// –í–µ—Ä—Å–∏—è API
#version 460 core

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—É—Ä–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è Flutter
#include <flutter/runtime_effect.glsl>

// –¢–æ—á–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π GPU
precision mediump float;

...
```

–í—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ª—É—á–∞–µ–º –æ—à–∏–±–∫—É –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –í –∫–æ–¥–µ –Ω–∞—Ö–æ–¥–∏–º `gl_FragColor` –∏ `gl_FragCoord`, –Ω–∞–º –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –∏—Ö –Ω–∞ `fragColor` –∏ `FlutterFragCoord()` –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–∞–Ω–µ–µ.

```glsl
// –í–µ—Ä—Å–∏—è API
#version 460 core

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—É—Ä–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è Flutter
#include <flutter/runtime_effect.glsl>

// –¢–æ—á–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π GPU
precision mediump float;

// –ò—Ç–æ–≥–æ–≤—ã–π —Ü–≤–µ—Ç –ø–∏–∫—Å–µ–ª—è
out vec4 fragColor;

uniform float time;
uniform vec2 mouse;
uniform vec2 resolution;

const int MAXITER = 30;

vec3 field(vec3 p) {
	p *= .1;
	float f = .1;
	for (int i = 0; i < 3; i++) {
		p = p.yzx; //*mat3(.8,.6,0,-.6,.8,0,0,0,1);
//		p += vec3(.123,.456,.789)*float(i);
		p = abs(fract(p)-.5);
		p *= 2.0;
		f *= 2.0;
	}
	p *= p;
	return sqrt(p+p.yzx)/f-.05;
}

void main() {
	vec3 dir = normalize(vec3((FlutterFragCoord().xy-resolution*.5)/resolution.x,1.));
	float a = time * 0.1;
	vec3 pos = vec3(0.0,time*0.1,0.0);
	dir *= mat3(1,0,0,0,cos(a),-sin(a),0,sin(a),cos(a));
	dir *= mat3(cos(a),0,-sin(a),0,1,0,sin(a),0,cos(a));
	vec3 color = vec3(0);
	for (int i = 0; i < MAXITER; i++) {
		vec3 f2 = field(pos);
		float f = min(min(f2.x,f2.y),f2.z);
		
		pos += dir*f;
		color += float(MAXITER-i)/(f2+.01);
	}
	vec3 color3 = vec3(1.-1./(1.+color*(.09/float(MAXITER*MAXITER))));
	color3 *= color3;
	fragColor = vec4(vec3(color3.r+color3.g+color3.b),1.);
}
```

–ó–∞–ø—É—Å–∫–∞–µ–º –µ—â—ë —Ä–∞–∑. –û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø—Ä–æ–ø–∞–ª–∞, –Ω–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∑–∏–ª–æ—Å—å, —Ç–∞–∫–∂–µ –≤ –ª–æ–≥–∞—Ö –æ—à–∏–±–∫–∏ –æ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —à–µ–π–¥–µ—Ä–∞ —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º–∏ –Ω–∞–º–∏. –ï—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–æ–¥ —à–µ–π–¥–µ—Ä–∞, —Ç–æ –º—ã –≤–∏–¥–∏–º —á—Ç–æ –æ–∂–∏–¥–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—á–∞ 3 –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:

- `float time` ‚Äî –≤—Ä–µ–º—è, –º–æ–∂–Ω–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–∞–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏.
- `vec2 mouse` ‚Äî —Ç–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –∫—É—Ä—Å–æ—Ä–∞ –º—ã—à–∏, –æ—Ç —ç—Ç–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –º—ã –∏–∑–±–∞–≤–∏–º—Å—è, –Ω–∞–º –æ–Ω –Ω–µ –Ω—É–∂–µ–Ω.
- `vec2 resolution` ‚Äî —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞.

–ò—Ç–æ–≥–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞—à–µ–≥–æ —à–µ–π–¥–µ—Ä–∞ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```glsl
// –í–µ—Ä—Å–∏—è API
#version 460 core

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—É—Ä–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è Flutter
#include <flutter/runtime_effect.glsl>

// –¢–æ—á–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π GPU
precision mediump float;

// –ò—Ç–æ–≥–æ–≤—ã–π —Ü–≤–µ—Ç –ø–∏–∫—Å–µ–ª—è
out vec4 fragColor;

uniform float time;
uniform vec2 resolution;

const int MAXITER = 30;

vec3 field(vec3 p) {
	p *= .1;
	float f = .1;
	for (int i = 0; i < 3; i++) {
		p = p.yzx;
		p = abs(fract(p)-.5);
		p *= 2.0;
		f *= 2.0;
	}
	p *= p;
	return sqrt(p+p.yzx)/f-.05;
}

void main() {
	vec3 dir = normalize(vec3((FlutterFragCoord().xy-resolution*.5)/resolution.x,1.));
	float a = time * 0.1;
	vec3 pos = vec3(0.0,time*0.1,0.0);
	dir *= mat3(1,0,0,0,cos(a),-sin(a),0,sin(a),cos(a));
	dir *= mat3(cos(a),0,-sin(a),0,1,0,sin(a),0,cos(a));
	vec3 color = vec3(0);
	for (int i = 0; i < MAXITER; i++) {
		vec3 f2 = field(pos);
		float f = min(min(f2.x,f2.y),f2.z);
		
		pos += dir*f;
		color += float(MAXITER-i)/(f2+.01);
	}
	vec3 color3 = vec3(1.-1./(1.+color*(.09/float(MAXITER*MAXITER))));
	color3 *= color3;
	fragColor = vec4(vec3(color3.r+color3.g+color3.b),1.);
}
```

–ü–æ–ø—Ä–∞–≤–∏–º –∫–æ–¥ `CustomPainter`.

```dart
class ShaderPainter extends CustomPainter {
  final FragmentShader shader;

  ShaderPainter({ required this.shader });

  @override
  void paint(Canvas canvas, Size size) {
    shader
      ..setFloat(0, 0)
      ..setFloat(1, size.width)
      ..setFloat(2, size.height);

    final paint = Paint()..shader = shader;
    canvas.drawRect(
      Rect.fromLTWH(0, 0, size.width, size.height),
      paint,
    );
  }

  @override
  bool shouldRepaint(covariant CustomPainter oldDelegate) => false;
}
```

–í—É–∞–ª—è, –Ω–∞ —ç–∫—Ä–∞–Ω–µ –æ—Ç–æ–±—Ä–∞–∑–∏–ª–∞—Å—å —Å–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞.

![Group_e867169b3b.svg](https://yastatic.net/s3/education-portal/media/Group_e867169b3b_eed0166f07.svg)

–ö–∞–∫ –≤–∏–¥–Ω–æ –≤ –∫–æ–¥–µ –≤—ã—à–µ, –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –º—ã –ø–µ—Ä–µ–¥–∞—ë–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –ß—Ç–æ–±—ã –æ–∂–∏–≤–∏—Ç—å –Ω–∞—à —à–µ–π–¥–µ—Ä, –¥–æ–±–∞–≤–∏–º –∞–Ω–∏–º–∞—Ü–∏—é –∏ –ø–µ—Ä–µ–¥–∞–¥–∏–º –µ—ë –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä.

```dart
class ShaderPainter extends CustomPainter {
  final Animation<double> animation;
  final FragmentShader shader;

  ShaderPainter({
    required this.shader,
    required this.animation,
  }) : super(repaint: animation);

  @override
  void paint(Canvas canvas, Size size) {
    shader
      ..setFloat(0, animation.value)
      ..setFloat(1, size.width)
      ..setFloat(2, size.height);

    final paint = Paint()..shader = shader;
    canvas.drawRect(
      Rect.fromLTWH(0, 0, size.width, size.height),
      paint,
    );
  }

  @override
  bool shouldRepaint(covariant CustomPainter oldDelegate) => false;
}
```

–í –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∞–µ–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Å–ª–µ–¥—É—é—â—É—é –∫–∞—Ä—Ç–∏–Ω—É.

<iframe width="100%" height="500" src="https://frontend.vh.yandex.ru/player/409499117b3e64f2a627aca60233c8a0?from=partner&mute=1&autoplay=1&tv=0&loop=true&play_on_visible=false" allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; encrypted-media" frameborder="0" scrolling="no" allowfullscreen></iframe>

–í–æ—Ç –∏ –≤—Å—ë! –¢–µ–ø–µ—Ä—å –º—ã –∫–∞–∫ —Å–ª–µ–¥—É–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–ª–∏ `CustomPainter`: –Ω–∞—É—á–∏–ª–∏—Å—å –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–∏—Å–æ–≤–∞—Ç—å –¥–æ–º–∏–∫–∏, –Ω–æ –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å–ª–æ—è–º–∏, –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —à–µ–π–¥–µ—Ä—ã –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–º–µ—à–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é `BlendMode`. 

–ï—Å–ª–∏ –≤–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —É–≥–ª—É–±–∏—Ç—å—Å—è –≤ —ç—Ç–æ —Ç–µ–º—É –µ—â—ë —Å–∏–ª—å–Ω–µ–µ, —Ç–æ –≤–æ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Å—Å—ã–ª–∫–∏: 

- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://api.flutter.dev/flutter/rendering/CustomPainter-class.html) –ø–æ CustomPainter.
- –°—Ç–∞—Ç—å—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ [—à–µ–π–¥–µ—Ä–æ–≤](https://habr.com/ru/companies/friflex/articles/713298/) –≤–æ Flutter.
- –í–∏–¥–µ–æ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ [—à–µ–π–¥–µ—Ä–æ–≤](https://www.youtube.com/watch?v=OpcPZdfJbq8) –≤–æ Flutter.
- –í–∏–¥–µ–æ: [—Ä–∏—Å–æ–≤–∞–Ω–∏–µ](https://www.youtube.com/watch?v=pD38Yyz7N2E) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–µ—Ä—à–∏–Ω.

–ê –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞—Ö –º—ã –¥–µ—Ç–∞–ª—å–Ω–µ–µ –∏–∑—É—á–∏–º –ø—Ä–æ—Ü–µ—Å—Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ Flutter ‚Äî —Ä–µ–Ω–¥–µ—Ä-–¥–µ—Ä–µ–≤–æ, –∞ —Ç–∞–∫–∂–µ –µ–≥–æ –≤–∞–∂–Ω–µ–π—à–∏–π —ç–ª–µ–º–µ–Ω—Ç ‚Äî `RenderObject`.